<!DOCTYPE html>
<html>
  <head>
    <title>Tangram Production</title>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lodash@4.17.10/lodash.min.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-external-html.js"></script>
    <script type="text/javascript" src="consent/consent.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="jspsych-6.1.0/css/jspsych.css"></link>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  </head>
  <body></body>

    <script>

    /* get info from turk */
    var turkInfo = jsPsych.turk.turkInfo();

    /* create timeline */
    var timeline = [];


    // reCAPTCHA object
    // var recaptcha = {
    //   type: "external-html",
    //   url: "recaptcha.html",
    //   cont_btn: "submit_button",
    //   execute_script: true
    // };
    // timeline.push(recaptcha);

    // consent form
    var consent = {
      type:'external-html',
      url: "consent/consent.html",
      cont_btn: "start"
    };
      //timeline.push(consent);

    // trials

    var instructions = {
      type: "html-button-response",
      stimulus: "<p>In this experiment, you will see one or more pictures on the screen at a time.</p><p>One of the objects will be in a <span style='color:blue'>blue box</span>.</p><p>Please describe this object as best as you can in <strong>one word</strong>.</p><p>If there are multiple objects, describe the object in the <span style='color:blue'>blue box</span> so that someone else could guess which one of the two objects is in the <span style='color:blue'>blue box</span>.</p>",
      choices: ['Start'],
      data: {test_part: 'setup'},
      post_trial_gap: 1000
    };
    timeline.push(instructions);


    var close_tangrams = [
        {target: "images/A1.jpg", foil: "images/A2.jpg"},
        {target: "images/E1.jpg", foil: "images/F1.jpg"},
        {target: "images/G1.jpg", foil: "images/M1.jpg"},
        {target: "images/I1.jpg", foil: "images/J1.jpg"},
        {target: "images/B1.jpg", foil: "images/P1.jpg"},
        {target: "images/F1.jpg", foil: "images/W1.jpg"},
        {target: "images/H1.jpg", foil: "images/Y1.jpg"},
        {target: "images/K1.jpg", foil: "images/T1.jpg"},
    ];

    var far_tangrams = [
        {target: "images/A1.jpg", foil: "images/D1.jpg"},
        {target: "images/E1.jpg", foil: "images/C2.jpg"},
        {target: "images/G1.jpg", foil: "images/N1.jpg"},
        {target: "images/I1.jpg", foil: "images/R1.jpg"},
        {target: "images/B1.jpg", foil: "images/O1.jpg"},
        {target: "images/F1.jpg", foil: "images/C1.jpg"},
        {target: "images/H1.jpg", foil: "images/A2.jpg"},
        {target: "images/K1.jpg", foil: "images/V1.jpg"},
    ];


    var paired_trial = {
      type: "survey-text",
      preamble: function(){
        var target = ("<img style='border: 10px solid blue; margin: 50px' src='" +
                      jsPsych.timelineVariable('target', true) +
                      "' height='250px'>");
        var foil = ("<img style='margin: 50px' src='" +
                    jsPsych.timelineVariable('foil', true)+
                    "' height='250px'>");
        return _.shuffle([target, foil]).join('');
      },
      questions: [{prompt: "Describe the object in the <span style='color:blue'>blue border</span> in <strong>one word</strong> that uniquely identifes it compared to the other one", required: true, columns: 20}],
      data: {trialtype: tangram_variables},//, target: jsPsych.timelineVariable('target')},
      post_trial_gap: 500      
    };

    var tangram_close_trial = {
      timeline: [paired_trial],
      timeline_variables: close_tangrams,
      randomize_order: true,
      repetitions: 1
    }

    var tangram_far_trial = {
      timeline: [paired_trial],
      timeline_variables: far_tangrams,
      randomize_order: true,
      repetitions: 1
    }

    var alltrials = jsPsych.sampleWithoutReplacement([tangram_close_trial, tangram_far_trial, familiar_close_trial, familiar_far_trial], 1)
    
    timeline.push(alltrials)

    jsPsych.init({
      timeline: timeline,
      on_finish: function() {
      var data = jsPsych.data.get().csv();
      turk.submit(data);
      }
    })

    </script>

</html>
